{% extends 'base/base.html' %} {% block title %}Shop{% endblock title %} 
{% block style %}
<!-- Add your CSS here -->
{% endblock style %} 
{% block content %}
<!-- Breadcrumb Start -->
<div class="container-fluid">
  <div class="row px-xl-5">
    <div class="col-12">
      <nav class="breadcrumb bg-light mb-30">
        <a class="breadcrumb-item text-dark" href="#">Home</a>
        <a class="breadcrumb-item text-dark" href="#">Shop</a>
        <span class="breadcrumb-item active">Shop List</span>
      </nav>
    </div>
  </div>
</div>
<!-- Breadcrumb End -->

<!-- Shop Start -->
<div class="container-fluid">
  <div class="row px-xl-5">
    <!-- Shop Sidebar Start -->
    <div class="col-lg-3 col-md-4">
      <!-- Price Start -->
      <h5 class="section-title position-relative text-uppercase mb-3">
        <span class="bg-secondary pr-3">Filter by subcategories</span>
      </h5>
      <div class="bg-light p-4 mb-30">
        <form id="filter-form">
          <div
            class="custom-control custom-checkbox d-flex align-items-center justify-content-between mb-3"
          >
            <input
              type="checkbox"
              class="custom-control-input"
              id="price-all"
              checked
            />
            <label class="custom-control-label" for="price-all">All</label>
          </div>
          {% for item in subcategories %}
          <div
            class="custom-control custom-checkbox d-flex align-items-center justify-content-between mb-3"
          >
            <input
              type="checkbox"
              class="custom-control-input"
              id="price-{{ item.id }}"
              data-id="{{ item.id }}"
            />
            <label class="custom-control-label" for="price-{{ item.id }}"
              >{{ item.name }}</label
            >
          </div>
          {% endfor %}
        </form>
      </div>
      <!-- Price End -->
    </div>
    <!-- Shop Sidebar End -->

    <!-- Shop Product Start -->
    <div class="col-lg-9 col-md-8">
      <div class="row pb-3" id="product-list">
        {% for item in products %}
        <!-- <div class="col-lg-4 col-md-6 col-sm-6 pb-1">
                    <div class="product-item bg-light mb-4">
                        <div class="product-img position-relative overflow-hidden">
                            <img class="img-fluid w-100" src="{{ item.image.url }}" alt="">
                            <div class="product-action">
                                <a class="btn btn-outline-dark btn-square" href=""><i class="fa fa-shopping-cart"></i></a>
                                <a class="btn btn-outline-dark btn-square" href=""><i class="far fa-heart"></i></a>
                                <a class="btn btn-outline-dark btn-square" href=""><i class="fa fa-sync-alt"></i></a>
                                <a class="btn btn-outline-dark btn-square" href="{% url 'productdetial' item.id %}"><i class="fa fa-search"></i></a>
                            </div>
                        </div>
                        <div class="text-center py-4">
                            <a class="h6 text-decoration-none text-truncate" href="">{{ item.name }}</a>
                            <div class="d-flex align-items-center justify-content-center mt-2">
                                <a href="{% url 'productdetial' item.id %}"><h5>${{ item.price }}iuiug</h5></a>
                            </div>
                        </div>
                    </div>
                </div> -->
        {% endfor %}
      </div>
      <div class="col-12" id="pagination">
        <!-- Pagination will be added dynamically by JavaScript -->
      </div>
    </div>
    <!-- Shop Product End -->
  </div>
</div>
<!-- Shop End -->

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const filterForm = document.getElementById("filter-form");
    const productList = document.getElementById("product-list");
    const pagination = document.getElementById("pagination");

    function loadProducts(subcategoryId, pageNumber = 1) {
      const params = new URLSearchParams({
        subcategory_id: subcategoryId,
        page: pageNumber,
      });

      fetch(`/shop/{{ category.name }}?${params.toString()}`, {
        method: "GET",
        headers: {
          "X-Requested-With": "XMLHttpRequest",
        },
      })
        .then((response) => response.json())
        .then((data) => {
          const baseURL = "/media/"; // Update this if your MEDIA_URL is different
          productList.innerHTML = data.products
            .map(
              (product) => `
                    <div class="col-lg-4 col-md-6 col-sm-6 pb-1">
                        <div class="product-item bg-light mb-4">
                            <div class="product-img position-relative overflow-hidden">
                                <img class="img-fluid w-100" src="${baseURL}${product.image}" alt="${product.name}">
                                <div class="product-action">
                                    <a class="btn btn-outline-dark btn-square" href=""><i class="far fa-heart"></i></a>
                                    <a class="btn btn-outline-dark btn-square" href="http://127.0.0.1:8000/productdetial/${product.id}"><i class="fa fa-search"></i></a>
                                </div>
                            </div>
                            <div class="text-center py-4">
                                <a class="h6 text-decoration-none text-truncate" href="">${product.name}</a>
                                <div class="d-flex align-items-center justify-content-center mt-2">
                                                               <h6 class="text-muted ml-2"><del class="">&#8377;${product.price}</del><span class="text-success mx-2"> - ${product.discount}%</span></h6>
                           <h5 class="mx-2">&#8377;${product.discounted_price}/-</h5>
                              
                                    
                                </div>
                                <div>
                                    <a href="http://127.0.0.1:8000/productdetial/${product.id}"><button class="btn btn-info text-white ">Buy now</button></a>
                            <form method="post" action="http://127.0.0.1:8000/add_to_cart/${product.id}/">
                            {% csrf_token %}
                            <button type="submit" class="btn btn-primary px-3"><i class="fa fa-shopping-cart mr-1"></i> Add To Cart</button>
                            </form>
                                </div>
                            </div>
                        </div>
                    </div>
                `
            )
            .join("");

          // Update pagination
          pagination.innerHTML = `
                    <nav>
                        <ul class="pagination justify-content-center">
                            ${
                              data.has_previous
                                ? `<li class="page-item"><a class="page-link" href="#" data-page="${
                                    data.page_number - 1
                                  }">Previous</a></li>`
                                : '<li class="page-item disabled"><a class="page-link" href="#">Previous</a></li>'
                            }
                            ${Array.from(
                              { length: data.num_pages },
                              (_, i) => `
                                <li class="page-item ${
                                  data.page_number === i + 1 ? "active" : ""
                                }">
                                    <a class="page-link" href="#" data-page="${
                                      i + 1
                                    }">${i + 1}</a>
                                </li>
                            `
                            ).join("")}
                            ${
                              data.has_next
                                ? `<li class="page-item"><a class="page-link" href="#" data-page="${
                                    data.page_number + 1
                                  }">Next</a></li>`
                                : '<li class="page-item disabled"><a class="page-link" href="#">Next</a></li>'
                            }
                        </ul>
                    </nav>
                `;
        });
    }

    filterForm.addEventListener("change", function (e) {
      if (e.target.type === "checkbox") {
        const subcategoryId = e.target.dataset.id;
        loadProducts(subcategoryId);
      }
    });

    pagination.addEventListener("click", function (e) {
      if (e.target.tagName === "A" && e.target.dataset.page) {
        const pageNumber = e.target.dataset.page;
        const subcategoryId =
          document.querySelector('input[type="checkbox"]:checked')?.dataset
            .id || "";
        loadProducts(subcategoryId, pageNumber);
      }
    });

    // Initial load
    loadProducts("");
  });
</script>
{% endblock content%}
